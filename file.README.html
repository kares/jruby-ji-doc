<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; JRuby&#39;s Java Integration
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'>
<h1 id="label-Calling+Java+from+JRuby">Calling Java from JRuby</h1>

<p>All the following examples can be “run” either from the command line, or by
using <strong>jirb_swing</strong>, the Swing-based IRB console that comes
with JRuby. You can start jirb_swing like <code>$ jruby -S
jirb_swing</code>.</p>

<p>A special <code>require &#39;java&#39;</code> directive in your file will
give you access to any bundled Java libraries (classes within your java
class path). If you need to access Java libraries not contained with the
Java class path we will show you how to do that in a later section.</p>

<p>The following code shows typical use. It should pop up a small window
showing “Hello” on your screen.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># This is the &#39;magical Java require line&#39;.
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>java</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># With the &#39;require&#39; above, we can now refer to things that are part of the
</span><span class='comment'># standard Java platform via their full paths.
</span><span class='id identifier rubyid_frame'>frame</span> <span class='op'>=</span> <span class='id identifier rubyid_javax'>javax</span><span class='period'>.</span><span class='id identifier rubyid_swing'>swing</span><span class='period'>.</span><span class='const'>JFrame</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Window</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># Creating a Java JFrame
</span><span class='id identifier rubyid_label'>label</span> <span class='op'>=</span> <span class='id identifier rubyid_javax'>javax</span><span class='period'>.</span><span class='id identifier rubyid_swing'>swing</span><span class='period'>.</span><span class='const'>JLabel</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='comment'># We can transparently call Java methods on Java objects, just as if they were defined in Ruby.
</span><span class='id identifier rubyid_frame'>frame</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_label'>label</span><span class='rparen'>)</span>  <span class='comment'># Invoking the Java method &#39;add&#39;.
</span><span class='id identifier rubyid_frame'>frame</span><span class='period'>.</span><span class='id identifier rubyid_setDefaultCloseOperation'>setDefaultCloseOperation</span><span class='lparen'>(</span><span class='id identifier rubyid_javax'>javax</span><span class='period'>.</span><span class='id identifier rubyid_swing'>swing</span><span class='period'>.</span><span class='const'>JFrame</span><span class='op'>::</span><span class='const'>EXIT_ON_CLOSE</span><span class='rparen'>)</span>
<span class='id identifier rubyid_frame'>frame</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span>
<span class='id identifier rubyid_frame'>frame</span><span class='period'>.</span><span class='id identifier rubyid_setVisible'>setVisible</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
</code></pre>

<p><strong>Note:</strong> If you are testing the example above in the Swing
IRB console <code>jirb_swing</code>, change the default close operation to
<code>DISPOSE_ON_CLOSE</code>, or <code>HIDE_ON_CLOSE</code> unless you
want <code>jirb_swing</code> to also close when you close the second
window.</p>

<p>Here&#39;s another example (showing results from testing these statements
in the <code>jirb</code> console).</p>

<p>Let&#39;s say you wanted to get a list of network interfaces. You can get
Java API docs at <a
href="http://java.sun.com/j2se/1.5.0/docs/api/index.html">java.net.NetworkInterface</a>.</p>

<p>Here&#39;s how to access the methods from this Java Class from from JRuby:</p>

<pre class="code ruby"><code class="ruby">irb(main):013:0&gt; ni = java.net.NetworkInterface.networkInterfaces
  =&gt; #&lt;#&lt;Class:01x7e666f&gt;:0x855a27 @java_object=java.net.NetworkInterface$1@821453&gt;
</code></pre>

<p><strong><code>ni</code></strong> is a Ruby variable holding a Java
Enumeration of NetworkInterfaces. You can see the Class ancestry for
<code>ni</code> like this:</p>

<pre class="code ruby"><code class="ruby">irb(main):029:0&gt; ni.class.ancestors
  =&gt; [#&lt;Class:01x7e666f&gt;, Java::JavaUtil::Enumeration, Enumerable, Java::JavaLang::Object, ConcreteJavaProxy, JavaProxy, JavaProxyMethods, Object, Java, Kernel]
</code></pre>

<p>Enumeration elements can&#39;t be accessed using <code>Array#[]</code>
syntax but they do appear as Arrays for many other purposes. You can find
out both the Java and Ruby methods for an Enumeration of NetworkInterfaces
like this:</p>

<pre class="code ruby"><code class="ruby">irb(main):032:0&gt; java.net.NetworkInterface.networkInterfaces.methods
  =&gt; [&quot;__jsend!&quot;, &quot;has_more_elements&quot;, &quot;hasMoreElements&quot;, &quot;next_element&quot;, &quot;nextElement&quot;,
  &quot;each&quot;, &quot;reject&quot;, &quot;member?&quot;, &quot;grep&quot;, &quot;include?&quot;, &quot;min&quot;, &quot;sort&quot;, &quot;any?&quot;, &quot;partition&quot;, 
  &quot;each_with_index&quot;, &quot;collect&quot;, &quot;find_all&quot;, &quot;to_a&quot;,  &quot;inject&quot;, &quot;detect&quot;, &quot;map&quot;, &quot;zip&quot;, 
  &quot;sort_by&quot;, &quot;max&quot;, &quot;entries&quot;, &quot;all?&quot;, &quot;find&quot;, &quot;select&quot;, ...]
</code></pre>

<p>You could also call #to_a then use Array#[] on them, etc.</p>

<p>Because JRuby supports the <code>#each</code> method on Java Enumerations
you could also do this:</p>

<pre class="code ruby"><code class="ruby">irb(main):011:0&gt; java.net.NetworkInterface.networkInterfaces.each {|i| puts i; puts }
  name:en1 (en1) index: 5 addresses:
  /63.138.152.170;
  /fe80:0:0:0:21b:63ff:febf:4a9d%5;
  
  name:en0 (en0) index: 4 addresses:
  /63.138.152.125;
  /fe80:0:0:0:21b:63ff:fe1e:b2da%4;
  
  name:lo0 (lo0) index: 1 addresses:
  /127.0.0.1;
  /fe80:0:0:0:0:0:0:1%1;
  /0:0:0:0:0:0:0:1%0;
</code></pre>

<h2 id="label-Accessing+and+Importing+Java+Classes">Accessing and Importing Java Classes</h2>

<h3 id="label-From+jar+files">From jar files</h3>

<p>To use resources within a jar file from JRuby, the jar file must either be
on the classpath <em>or</em> be made available with the
<code>require</code> method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>path/to/mycode.jar</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>This <code>require</code> makes the resources in <code>mycode.jar</code>
discoverable by later commands like <code>import</code> and
<code>include_package</code>.</p>

<p>Note that loading jar-files via <code>require</code> searches along the
<code>$LOAD_PATH</code> for them, like it would for normal ruby files.</p>

<h3 id="label-From+.class+files">From .class files</h3>

<p>If you need to load from an existing .class file (or one that&#39;s not
camel-case), the following has examples: [[<a
href="http://www.ruby-forum.com/topic/216572#939791">www.ruby-forum.com/topic/216572#939791</a>]]</p>

<p>Basically it&#39;s <code>$CLASSPATH &lt;&lt; &quot;target/classes&quot;;
java_import org.asdf.ClassName</code> where
“target/classes/org/asdf/ClassName.class” exists.</p>

<p>Note also that this will need to be a full path name or relative to the
directory the script starts in, as the JVM doesn&#39;t seem to respond to
Dir.chdir very well.</p>

<h2 id="label-Referencing+Java+Classes+%28using+full-qualified+class+name%29">Referencing Java Classes (using full-qualified class name)</h2>

<p>You can reference a Java class in JRuby in at least two different ways.</p>
<ul><li>
<p>The first is to map Java names like <code>org.foo.department.Widget</code>
to Ruby nested modules format. This works as follows:</p>
</li></ul>

<pre class="code ruby"><code class="ruby">Java: org.foo.department.Widget
Ruby: Java::OrgFooDepartment::Widget</code></pre>

<p>That is:</p>
<ul><li>
<p>Java packages all reside within the <code>Java</code> module.</p>
</li><li>
<p>The package path is then transformed by removing the dots and converting to
<em>CamelCase</em></p>
</li></ul>

<p>This also means that, just as in Java, packages are not nested, but are
each associated with their own unique module name.</p>
<ul><li>
<p>Second way: for the top-level Java packages <code>java</code>,
<code>javax</code>, <code>org</code>, and <code>com</code> you can type in
a fully qualified class name basically as in Java, for example,
<code>java.lang.System</code> or <code>org.abc.def.ClassName</code> You can
get the same effect for your own (custom) top-level packages, as follows.
Let&#39;s assume that your packages are called
<code>edu.school.department.Class</code>. Then, you define</p>
</li></ul>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_edu'>edu</span>
  <span class='const'>Java</span><span class='op'>::</span><span class='const'>Edu</span>
<span class='kw'>end</span>
</code></pre>

<p>And then you can use use usual Java package names like
<code>edu.abc.def.ClassName</code> Note also that you must use the right
capitalization, though see below for how you can change and assign it to
your own liking.</p>

<h2 id="label-Using+a+Java+Class+Without+The+Full+Path+Name">Using a Java Class Without The Full Path Name</h2>

<p>You can always access any Java class that has been loaded or is in the
classpath by specifying its full name (e.g. java.lang.System). With the
<code>java_import</code> statement, you can access the Java class via a
constant that java_import creates for you in the current namespace.
Let&#39;s consider how to make using <code>java.lang.System</code> easier
to use:</p>

<p><strong>Note:</strong> For older scripts where <code>import</code> was used
we have deprecated that for <code>java_import</code> to not conflict with
rake.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>java</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_java_import'>java_import</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>System</span>
  <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='const'>System</span><span class='period'>.</span><span class='id identifier rubyid_getProperties'>getProperties</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>java.runtime.version</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
</code></pre>

<p>In this script when java_import executes it will make a new constant for
you called <code>System</code>. As this is happening in a top-level script
it will be put into ::Object. Now in the next line you can just use
<code>System</code>.</p>

<p>As this is just a constant you need to be wary of redefining or papering
over other constants. Consider an example like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>set</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_java_import'>java_import</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_util'>util</span><span class='period'>.</span><span class='const'>Set</span>
</code></pre>

<p>In this case you defined the constant <code>Set</code> on
<code>::Object</code> from Ruby&#39;s set library and then you overwrote
the constant <code>Set</code> on <code>::Object</code> by calling
<code>java_import</code>. Luckily, in this case you will see a warning
telling you that you changed a constant definition. This example also gives
a cautionary tale.</p>

<p>Java and Ruby classes have an overlap on naming. So if you include a Java
Class at a top-level scope it can mess up the world of Ruby since what you
thought was a Ruby set suddenly becomes a Java one. Ruby&#39;s constant
resolution is much more tricky than it seems so reviewing an article on <a
href="http://valve.github.io/blog/2013/10/26/constant-resolution-in-ruby/">constant
resolution</a> may help you to better understand how constants work. Our
recommendation is to namespace your java_imports into the non-top-level
namespace in a Ruby program of any size.</p>

<p>A more confusing example is when you unintentionally wallpaper over a
constant:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>set</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>module</span> <span class='const'>MyClass</span>
  <span class='id identifier rubyid_java_import'>java_import</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_util'>util</span><span class='period'>.</span><span class='const'>Set</span>

  <span class='const'>Set</span> <span class='comment'># 1. ???
</span><span class='kw'>end</span>

<span class='const'>Set</span> <span class='comment'># 2. ???
</span></code></pre>

<p>The <code>java_import</code> will define a <code>Set</code> on
<code>MyClass</code> (e.g. <code>MyClass::Set</code>). If you access
<code>Set</code> at 1 you will get this new constant. If you access
<code>Set</code> at 2 you will get <code>Object::Set</code>. Both of these
examples are just cases how constants in Ruby work but the implicit
constant creation of java_import can trip programmers up.</p>

<p>Some people do not like the implicit side-effect nature of
<code>java_import</code>, so you can also get the same effect by
reassigning a Java class to a new constant, like</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>java</span><span class='tstring_end'>&#39;</span></span>
  <span class='const'>Sys</span> <span class='op'>=</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>System</span>
  <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='const'>Sys</span><span class='period'>.</span><span class='id identifier rubyid_getProperties'>getProperties</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>java.runtime.version</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
</code></pre>

<h2 id="label-Use+include_package+within+a+Ruby+Module+to+import+a+Java+Package%27s+classes+on+const_missing">Use <code>include_package</code> within a Ruby Module to import a Java Package&#39;s classes on const_missing</h2>

<p>Use <code>include_package &quot;package_name&quot;</code> in a Ruby Module
to support namespaced access to the Java classes in the package. This is
similar to Java&#39;s <code>package xxx.yyy.zzz;</code> format. It is also
legal to use <code>import &quot;package_name&quot;</code>, that is similar
to <code>import package_name.*</code>.</p>

<p><strong>Example</strong>: using <code>include_package</code> in a module</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>MyApp</span>
 <span class='id identifier rubyid_include_package'>include_package</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>org.apache.logging.log4j</span><span class='tstring_end'>&#39;</span></span>
 <span class='comment'># now any class from &quot;org.apache.logging.log4j&quot; will be available within
</span> <span class='comment'># this module, ex if &quot;org.apache.logging.log4j.LogManager&quot; exists ...
</span> <span class='const'>Logger</span> <span class='op'>=</span> <span class='const'>LogManager</span><span class='period'>.</span><span class='id identifier rubyid_getLogger'>getLogger</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MyApp</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<p><strong>Example</strong>: create a Ruby Module called <code>JavaLang</code>
that includes the classes in the Java package <code>java.lang</code>.
<code>ruby   module JavaLangDemo     include_package &#39;java.lang&#39;   
# alternately, use the #import method     #import &#39;java.lang&#39;   end
</code></p>

<p>Now you can prefix the desired Java Class name with
<code>JavaLangDemo::</code> to access the included Classes:</p>

<pre class="code ruby"><code class="ruby">version = JavaLangDemo::System.out # java.lang.System.out
  =&gt; #&lt;Java::JavaIo::PrintStream:0x30a7202&gt;

  processors = JavaLangDemo::Runtime.getRuntime.availableProcessors
  =&gt; 2
</code></pre>

<p>All Java classes in the package will become be available in this
class/module, unless a constant with the same name as a Java class is
already defined.</p>

<p>The use of the Module name to scope access to the imported Java class is
also helpful in cases where the Java class has the same name as an existing
Ruby class.</p>

<p>For example if you need to create an instance of a
<code>java.io.File</code> object, this code will work:</p>

<pre class="code ruby"><code class="ruby">java_import java.io.File
  newfile = File.new(&quot;file.txt&quot;)
  =&gt; #&lt;Java::JavaIo::File:0xdc6f00 @java_object=file.txt&gt;
</code></pre>

<p>However you&#39;ve now redefined the Ruby constant File and can no longer
access the Ruby File class. Executing this:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>README</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>r</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_readline'>readline</span> <span class='rbrace'>}</span>
</code></pre>

<p>Will produce this error:</p>

<pre class="code ruby"><code class="ruby">NoMethodError: private method `open&#39; called for Java::JavaIo::File:Class
</code></pre>

<p>If instead you create a module called <code>JavaIO</code> and include the
package in the module definition:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>JavaIO</span>
    <span class='id identifier rubyid_include_package'>include_package</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>java.io</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
</code></pre>

<p>You can now create a new instance of the Java class File without shadowing
the Ruby version of the File class:</p>

<pre class="code ruby"><code class="ruby">newfile = JavaIO::File.new(&quot;file.txt&quot;)
  =&gt; #&lt;Java::JavaIo::File:0x15619c @java_object=file.txt&gt;
</code></pre>

<p>And the Ruby File class is still accessible:</p>

<pre class="code ruby"><code class="ruby">File.open(&#39;README.md&#39;, &#39;r&#39;) {|f| puts f.readline }
  JRuby -  A Java implementation of the Ruby language
  =&gt; nil
</code></pre>

<h2 id="label-Making+them+accessible+in+the+main+name+space">Making them accessible in the main name space</h2>

<p>You can set <code>const_missing</code> to make them accessible in more than
just a module. See [[<a
href="http://www.ruby-forum.com/topic/216629">www.ruby-forum.com/topic/216629</a>]]
though there might be a better way.</p>

<h2 id="label-Using+within+classes+within+module">Using within classes within module</h2>

<p>Currently, <code>include_package</code> lookup doesn&#39;t work within any
sub-modules or sub-classes e.g. running :</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>GUI</span>
    <span class='id identifier rubyid_include_package'>include_package</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>javax.swing</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_include_package'>include_package</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>java.awt.image</span><span class='tstring_end'>&#39;</span></span> <span class='comment'># BufferedImage
</span>    <span class='comment'># bellow won&#39;t work without accessing BufferedImage before :
</span>    <span class='kw'>class</span> <span class='const'>ShowImage</span> <span class='op'>&lt;</span> <span class='const'>JFrame</span>
      <span class='const'>BufferedImage</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>10</span><span class='comma'>,</span> <span class='int'>20</span><span class='comma'>,</span> <span class='const'>BufferedImage</span><span class='op'>::</span><span class='const'>TYPE_BYTE_BINARY</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
</code></pre>

<pre class="code ruby"><code class="ruby">NameError: uninitialized constant GUI::ShowImage::BufferedImage
	from org/jruby/RubyModule.java:2743:in `const_missing&#39;
	from (irb):6:in `ShowImage&#39;
	from (irb):5:in `GUI&#39;
	from (irb):1:in `evaluate&#39;</code></pre>

<p>You could override <code>const_missing</code>, though (see above), if you
wanted that behavior.</p>

<h2 id="label-Using+Static+Java+Enumerations">Using Static Java Enumerations</h2>

<p>Java <code>enum</code>s are accessible from Ruby code as constants:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_lock'>lock</span><span class='period'>.</span><span class='id identifier rubyid_try_lock'>try_lock</span><span class='lparen'>(</span><span class='int'>5000</span><span class='comma'>,</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_util'>util</span><span class='period'>.</span><span class='id identifier rubyid_concurrent'>concurrent</span><span class='period'>.</span><span class='const'>TimeUnit</span><span class='op'>::</span><span class='const'>MILLISECONDS</span><span class='rparen'>)</span>
</code></pre>

<p>or</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_java_import'>java_import</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_util'>util</span><span class='period'>.</span><span class='id identifier rubyid_concurrent'>concurrent</span><span class='period'>.</span><span class='const'>TimeUnit</span>
  <span class='id identifier rubyid_lock'>lock</span><span class='period'>.</span><span class='id identifier rubyid_try_lock'>try_lock</span><span class='lparen'>(</span><span class='int'>5000</span><span class='comma'>,</span> <span class='const'>TimeUnit</span><span class='op'>::</span><span class='const'>MILLISECONDS</span><span class='rparen'>)</span>
</code></pre>

<h2 id="label-Gotchas">Gotchas</h2>

<p>JRuby automatically binds the following names in the context of a class to
the top-level Java packages: <code>com</code>, <code>org</code>,
<code>java</code>, <code>javax</code> and <code>javafx</code>. This means
that you can reference these packages without having to explicitly require
or import them. This takes effect for all Ruby classes in an application
where a <code>require &#39;java&#39;</code> appears. This binding takes
place in precedence to the classes <em>method_missing</em> handling.</p>

<p>If you do not want this behaviour for a specific class, you can undefine it
for that class. Here&#39;s an example that will execute identically under
Ruby and JRuby:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Note: Comment out for Ruby test. Uncomment for JRuby test.
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>java</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>MethodMissing</span>
  <span class='comment'># JRuby: Undefine the standard &quot;automatic&quot; bindings to Java, to avoid any automatic binding.
</span>  <span class='kw'>undef</span> <span class='id identifier rubyid_org'>org</span><span class='comma'>,</span> <span class='id identifier rubyid_com'>com</span><span class='comma'>,</span> <span class='id identifier rubyid_java'>java</span><span class='comma'>,</span> <span class='id identifier rubyid_javax'>javax</span><span class='comma'>,</span> <span class='id identifier rubyid_javafx'>javafx</span>
  
  <span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>method_missing: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This is what I return from method missing.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_mm'>mm</span> <span class='op'>=</span> <span class='const'>MethodMissing</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_mm'>mm</span><span class='period'>.</span><span class='id identifier rubyid_org'>org</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Result: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_result'>result</span><span class='embexpr_end'>}</span><span class='tstring_content'> Type: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<h2 id="label-Calling+a+Java+Method">Calling a Java Method</h2>

<h2 id="label-Alternative+Names+and+Beans+Convention">Alternative Names and Beans Convention</h2>

<p>In Ruby, one usually prefers <code>method_names_like_this</code>, while
Java traditionally uses <code>methodNamesLikeThis</code>. If you want, you
can use Ruby-style method names instead of the Java ones.</p>

<p>For example, these two calls are equivalent</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>System</span><span class='period'>.</span><span class='id identifier rubyid_currentTimeMillis'>currentTimeMillis</span>
  <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>System</span><span class='period'>.</span><span class='id identifier rubyid_current_time_millis'>current_time_millis</span>
</code></pre>

<p>JRuby also translates methods following the &#39;beans-convention&#39;:</p>

<pre class="code ruby"><code class="ruby">x.getSomething            becomes   x.something
  x.setSomething(newValue)  becomes   x.something = new_value
  x.isSomething             becomes   x.something?
</code></pre>

<p>You don&#39;t have to use these alternatives, but they can make the
interaction with Java code feel more Ruby-like.</p>

<h2 id="label-Constructors">Constructors</h2>

<p><code>JavaClass.new</code> or <code>JavaClass.new(x,y,z)</code> generally
works as expected. If you wish to select a particular constructor by
signature use reflection:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Get the the three-integer constructor for this class
</span> <span class='id identifier rubyid_construct'>construct</span> <span class='op'>=</span> <span class='const'>JavaClass</span><span class='period'>.</span><span class='id identifier rubyid_java_class'>java_class</span><span class='period'>.</span><span class='id identifier rubyid_constructor'>constructor</span><span class='lparen'>(</span><span class='const'>Java</span><span class='op'>::</span><span class='id identifier rubyid_int'>int</span><span class='comma'>,</span> <span class='const'>Java</span><span class='op'>::</span><span class='id identifier rubyid_int'>int</span><span class='comma'>,</span> <span class='const'>Java</span><span class='op'>::</span><span class='id identifier rubyid_int'>int</span><span class='rparen'>)</span>
 <span class='comment'># Use the constructor
</span> <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_construct'>construct</span><span class='period'>.</span><span class='id identifier rubyid_new_instance'>new_instance</span><span class='lparen'>(</span><span class='int'>0xa4</span><span class='comma'>,</span> <span class='int'>0x00</span><span class='comma'>,</span> <span class='int'>0x00</span><span class='rparen'>)</span>
</code></pre>

<h2 id="label-Beware+of+Java+generics">Beware of Java generics</h2>

<p>If a Java class is defined with Java generics, the types are erased during
compilation for backwards compatibility. As a result, JRuby will have
problems with automatic type conversion. For example, if you have a
<code>Map&lt;String,String&gt;</code>, it will be seen as a simple
<code>Map</code>, and JRuby will not be able to determine the correct types
using reflection.</p>

<h2 id="label-Additional+Java+Method+Access">Additional Java Method Access</h2>

<p>JRuby defines a number of additional methods for Java objects.</p>
<ul><li>
<p><code>java_class</code> returns the Java class of an object.</p>
</li><li>
<p><code>java_kind_of?</code> works like the <code>instanceof</code> operator.</p>
</li><li>
<p><code>java_object</code> returns the underlying Java object. This is useful
for reflection.</p>
</li><li>
<p><code>java_send</code> overrides JRuby&#39;s dispatch rules and forces the
execution of a named Java method on a Java object. This is useful for Java
methods, such as <code>initialize</code>, with names that conflict with
built-in Ruby methods (more on <code>java_send</code> below).</p>
</li><li>
<p><code>java_method</code> retrieves a bound or unbound handle for a Java
method to avoid the reflection inherent in <code>java_send</code> (more on
<code>java_method</code> below).</p>
</li><li>
<p><code>java_alias</code> aliases a specific method name and signature to a
new Ruby method name</p>
</li></ul>

<h2 id="label-Calling+masked+or+unreachable+Java+methods+with+java_send">Calling masked or unreachable Java methods with <code>java_send</code></h2>

<p>Sometimes you need to call <code>initialize</code> AFTER the
<code>.new()</code> call, for example the <code>RTPManager</code> class in
JMF. Unfortunately, this method is masked by Ruby&#39;s
<code>initialize</code> constructor method. As of JRuby 1.4, the
<code>java_send</code> method can be used to call this, and any other,
masked method:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@mgr</span> <span class='op'>=</span> <span class='id identifier rubyid_javax'>javax</span><span class='period'>.</span><span class='id identifier rubyid_media'>media</span><span class='period'>.</span><span class='id identifier rubyid_rtp'>rtp</span><span class='period'>.</span><span class='const'>RTPManager</span><span class='period'>.</span><span class='id identifier rubyid_newInstance'>newInstance</span>
  <span class='id identifier rubyid_localhost'>localhost</span> <span class='op'>=</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_net'>net</span><span class='period'>.</span><span class='const'>InetAddress</span><span class='period'>.</span><span class='id identifier rubyid_getByName'>getByName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_localaddr'>localaddr</span> <span class='op'>=</span> <span class='id identifier rubyid_javax'>javax</span><span class='period'>.</span><span class='id identifier rubyid_media'>media</span><span class='period'>.</span><span class='id identifier rubyid_rtp'>rtp</span><span class='period'>.</span><span class='const'>SessionAddress</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_localhost'>localhost</span><span class='comma'>,</span> <span class='int'>21000</span><span class='comma'>,</span> <span class='id identifier rubyid_localhost'>localhost</span><span class='comma'>,</span> <span class='int'>21001</span><span class='rparen'>)</span>
  <span class='ivar'>@mgr</span><span class='period'>.</span><span class='id identifier rubyid_java_send'>java_send</span> <span class='symbol'>:initialize</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_javax'>javax</span><span class='period'>.</span><span class='id identifier rubyid_media'>media</span><span class='period'>.</span><span class='id identifier rubyid_rtp'>rtp</span><span class='period'>.</span><span class='const'>SessionAddress</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_localaddr'>localaddr</span>
</code></pre>

<p>Here is another example of calling the <code>ArrayList.add</code> method
with <code>java_send</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_java_import'>java_import</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_util'>util</span><span class='period'>.</span><span class='const'>ArrayList</span>
 <span class='id identifier rubyid_list'>list</span> <span class='op'>=</span> <span class='const'>ArrayList</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
 <span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_java_send'>java_send</span> <span class='symbol'>:add</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='const'>Java</span><span class='op'>::</span><span class='id identifier rubyid_int'>int</span><span class='comma'>,</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>Object</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>
 <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_java_send'>java_send</span> <span class='symbol'>:toString</span> <span class='comment'># =&gt; &quot;[foo]&quot;
</span></code></pre>

<p>Note the second argument, which is an array of types indicating the exact
method signature desired. This is useful for disambiguating methods that
are overloaded on similar types such as <code>int</code> and
<code>long</code>.</p>

<h2 id="label-Bound+and+Unbound+Java+methods+with+java_method">Bound and Unbound Java methods with <code>java_method</code></h2>

<p><code>java_send</code> relies on reflection and may lead to poor
performance in some cases. Each time it is called, the desired method must
be relocated. With the <code>java_method</code> method you can get a
reference to any overloaded Java method as a Ruby Method object:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># get a bound Method based on the add(int, Object) method from ArrayList
</span> <span class='id identifier rubyid_add'>add</span> <span class='op'>=</span> <span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_java_method'>java_method</span> <span class='symbol'>:add</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='const'>Java</span><span class='op'>::</span><span class='id identifier rubyid_int'>int</span><span class='comma'>,</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>Object</span><span class='rbracket'>]</span>
 <span class='id identifier rubyid_add'>add</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre>

<p>Similarly, an Unbound method object can be retrieved:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># get an UnboundMethod from the ArrayList class:
</span> <span class='id identifier rubyid_toString'>toString</span> <span class='op'>=</span> <span class='const'>ArrayList</span><span class='period'>.</span><span class='id identifier rubyid_java_method'>java_method</span> <span class='symbol'>:toString</span>
 <span class='id identifier rubyid_toString'>toString</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='id identifier rubyid_list'>list</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span> <span class='comment'># =&gt; [foo, foo]
</span></code></pre>

<p><em>Note:</em> When specifying parameters to java_method, you access
primitive data types via <code>Java::</code>, i.e. <code>Java::char</code>,
<code>Java::int</code>. On the other hand, Classes must be specified
directly. <code>java.lang.String</code>, <code>java.io.InputStream</code>,
etc.</p>

<h2 id="label-Aliasing+a+specific+method+with+java_alias">Aliasing a specific method with <code>java_alias</code></h2>

<p>If you&#39;ll be calling a specific unreachable Java method a lot, or if a
Java method has many overloads and you want to avoid the overhead of
selecting the right one every time, you can use <code>java_alias</code> to
alias a specific Java method name + signature to a Ruby name.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_java_import'>java_import</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_util'>util</span><span class='period'>.</span><span class='const'>ArrayList</span>
 <span class='kw'>class</span> <span class='const'>ArrayList</span>
   <span class='id identifier rubyid_java_alias'>java_alias</span> <span class='symbol'>:simple_add</span><span class='comma'>,</span> <span class='symbol'>:add</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='const'>Java</span><span class='op'>::</span><span class='id identifier rubyid_int'>int</span><span class='comma'>,</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>Object</span><span class='rbracket'>]</span>
 <span class='kw'>end</span>
 <span class='id identifier rubyid_list'>list</span> <span class='op'>=</span> <span class='const'>ArrayList</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
 <span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_simple_add'>simple_add</span> <span class='int'>0</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<h2 id="label-Reflection">Reflection</h2>

<p>Here is an example that shows using java&#39;s reflection within jruby</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@mgr</span> <span class='op'>=</span> <span class='id identifier rubyid_javax'>javax</span><span class='period'>.</span><span class='id identifier rubyid_media'>media</span><span class='period'>.</span><span class='id identifier rubyid_rtp'>rtp</span><span class='period'>.</span><span class='const'>RTPManager</span><span class='period'>.</span><span class='id identifier rubyid_newInstance'>newInstance</span>
  <span class='id identifier rubyid_localhost'>localhost</span> <span class='op'>=</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_net'>net</span><span class='period'>.</span><span class='const'>InetAddress</span><span class='period'>.</span><span class='id identifier rubyid_getByName'>getByName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_localaddr'>localaddr</span> <span class='op'>=</span> <span class='id identifier rubyid_javax'>javax</span><span class='period'>.</span><span class='id identifier rubyid_media'>media</span><span class='period'>.</span><span class='id identifier rubyid_rtp'>rtp</span><span class='period'>.</span><span class='const'>SessionAddress</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_localhost'>localhost</span><span class='comma'>,</span> <span class='int'>21000</span><span class='comma'>,</span> <span class='id identifier rubyid_localhost'>localhost</span><span class='comma'>,</span> <span class='int'>21001</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='ivar'>@mgr</span><span class='period'>.</span><span class='id identifier rubyid_java_class'>java_class</span><span class='period'>.</span><span class='id identifier rubyid_declared_method'>declared_method</span><span class='lparen'>(</span><span class='symbol'>:initialize</span><span class='comma'>,</span> <span class='id identifier rubyid_javax'>javax</span><span class='period'>.</span><span class='id identifier rubyid_media'>media</span><span class='period'>.</span><span class='id identifier rubyid_rtp'>rtp</span><span class='period'>.</span><span class='const'>SessionAddress</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_method'>method</span><span class='period'>.</span><span class='id identifier rubyid_invoke'>invoke</span> <span class='ivar'>@mgr</span><span class='period'>.</span><span class='id identifier rubyid_java_object'>java_object</span><span class='comma'>,</span> <span class='id identifier rubyid_localaddr'>localaddr</span><span class='period'>.</span><span class='id identifier rubyid_java_object'>java_object</span>
</code></pre>

<h2 id="label-Conversion+of+Types">Conversion of Types</h2>

<h2 id="label-Ruby+to+Java">Ruby to Java</h2>

<p><em>See the JRuby rspec source code dir</em>
<code>spec/java_integration</code> <em>for many more examples.</em></p>

<p>When calling Java from JRuby, primitive Ruby types are converted to default
boxed Java types:</p>
<table>
	<tr>
		<th>Ruby Type</th>
		<th>Java Type</th>
	</tr>
	<tr>
		<td>"foo"</td>
		<td>java.lang.String</td>
	</tr>
	<tr>
		<td>1</td>
		<td>java.lang.Long</td>
	</tr>
	<tr>
		<td>1.0</td>
		<td>java.lang.Double</td>
	</tr>
	<tr>
		<td>true, false</td>
		<td>java.lang.Boolean</td>
	</tr>
	<tr>
		<td>1 << 128</td>
		<td>java.math.BigInteger</td>
	</tr>
</table>
<p>However, this does not mean that you cannot call methods expecting a
primitive type. You can also pass an integer to a method expecting a double
value. JRuby usually tries quite hard to find a method that can understand
your parameters.</p>

<p>If JRuby cannot find a matching method, it tries to pass the actual JRuby
objects instead (that is, the Java objects from the JRuby implementation).
A consequence of this is that if this fails you will see an error message
stating that JRuby hasn&#39;t found a method taking an object of class
<code>org.jruby.RubyObject</code> instead of the actual type.</p>

<p>If JRuby is not finding the exact method you want to call, perhaps because
of extreme ambiguity like <code>foo(int)</code> vs. <code>foo(long)</code>,
the <code>java_send</code> method can be used to disambiguate. See below.</p>

<h2 id="label-Java+to+Ruby">Java to Ruby</h2>

<p>When primitive Java types are passed to JRuby they are converted to the
following Ruby types:</p>
<table>
	<tr>
		<th>Java Type</th>
		<th>Ruby Type</th>
	</tr>
	<tr>
		<td>public String</td>
		<td>String</td>
	</tr>
	<tr>
		<td>public byte</td>
		<td>Fixnum</td>
	</tr>
	<tr>
		<td>public short</td>
		<td>Fixnum</td>
	</tr>
	<tr>
		<td>public char</td>
		<td>Fixnum</td>
	</tr>
	<tr>
		<td>public int</td>
		<td>Fixnum</td>
	</tr>
	<tr>
		<td>public long</td>
		<td>Fixnum</td>
	</tr>
	<tr>
		<td>public float</td>
		<td>Float</td>
	</tr>
	<tr>
		<td>public double</td>
		<td>Float</td>
	</tr>
</table>
<p>The Java Booleans true and false are coerced to the Ruby singleton classes
TrueClass and FalseClass which are represented in Ruby with the instances
true and false.</p>

<p>The <code>null</code> Java object is coerced to the Ruby class
<code>NilClass</code> which is represented in Ruby as the instance
<code>nil</code>.</p>

<h2 id="label-Java+Primitive+Classes">Java Primitive Classes</h2>

<p>Java primitive classes can be found in the Java module. For example,
<code>Java::byte</code> represents the primitive type byte in java. You can
get its class as follows:</p>
<table>
	<tr>
		<th>Ruby Code</th>
		<th>Java Class</th>
	</tr>
	<tr>
		<td>Java::JavaClass.for_name("byte")</td>
		<td>Java::byte.java_class</td>
	</tr>
	<tr>
		<td>Java::JavaClass.for_name("boolean")</td>
		<td>Java::boolean.java_class</td>
	</tr>
	<tr>
		<td>Java::JavaClass.for_name("byte")</td>
		<td>Java::byte.java_class</td>
	</tr>
	<tr>
		<td>Java::JavaClass.for_name("short")</td>
		<td>Java::short.java_class</td>
	</tr>
	<tr>
		<td>Java::JavaClass.for_name("char")</td>
		<td>Java::char.java_class</td>
	</tr>
	<tr>
		<td>Java::JavaClass.for_name("int")</td>
		<td>Java::int.java_class</td>
	</tr>
	<tr>
		<td>Java::JavaClass.for_name("long")</td>
		<td>Java::long.java_class</td>
	</tr>
	<tr>
		<td>Java::JavaClass.for_name("float")</td>
		<td>Java::float.java_class</td>
	</tr>
	<tr>
		<td>Java::JavaClass.for_name("double")</td>
		<td>Java::double.java_class</td>
	</tr>
</table>
<h2 id="label-Arrays">Arrays</h2>

<p>There are two ways of constructing Java arrays. One is to use the
<code>to_java</code> method of the class Array. The other is to use the
<code>[]</code> method for the primitive Java types.</p>

<p>Converting a Ruby Array to a Java Array The <code>to_java</code> method
constructs a Java array from a Ruby array:</p>

<pre class="code ruby"><code class="ruby">[1,2,3].to_java
  =&gt; [Ljava.lang.Object;@1a32ea4
</code></pre>

<p>By default, <code>to_java</code> constructs <code>Object</code> arrays. You
can specify the parameter with an additional argument which can either be a
symbol or a primitive class like <code>Java::double</code></p>

<pre class="code ruby"><code class="ruby">[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;].to_java(:string)
  =&gt; [Ljava.lang.String;@170984c

  [1, 2, 3.5].to_java Java::double
  =&gt; [D@9bc984
</code></pre>

<h2 id="label-Constructing+Empty+Java+Arrays">Constructing Empty Java Arrays</h2>

<p>Sometimes a Java library will need a fixed-length array, say for example a
byte buffer for a stream to read into. For this, you can use the
<code>[]</code> method of the primitive types in the Java module:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bytes'>bytes</span> <span class='op'>=</span> <span class='const'>Java</span><span class='op'>::</span><span class='id identifier rubyid_byte'>byte</span><span class='lbracket'>[</span><span class='int'>1024</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='comment'># Equivalent to Java&#39;s bytes = new byte[1024];
</span>  <span class='id identifier rubyid_strings'>strings</span> <span class='op'>=</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>String</span><span class='lbracket'>[</span><span class='int'>1024</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
</code></pre>

<h2 id="label-Ruby+String+to+Java+Bytes+and+back+again">Ruby String to Java Bytes and back again</h2>

<pre class="code ruby"><code class="ruby">bytes = &#39;a string&#39;.to_java_bytes
  =&gt; #&lt;#&lt;Class:01x9fcffd&gt;:0x40e825 @java_object=[B@3d476c&gt;

  string = String.from_java_bytes bytes
  =&gt; &quot;a string&quot;
</code></pre>

<h2 id="label-More+Conversions">More Conversions</h2>

<h3 id="label-java.io.InputStream+to%2Ffrom+IO"><code>java.io.InputStream</code> to/from <code>IO</code></h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_java_input_stream'>java_input_stream</span><span class='period'>.</span><span class='id identifier rubyid_to_io'>to_io</span> <span class='comment'># works for InputStreams, OutputStreams, and NIO Channels
</span>  <span class='id identifier rubyid_stream'>stream</span> <span class='op'>=</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_to_inputstream'>to_inputstream</span> <span class='comment'># also to_outputstream and to_channel
</span></code></pre>

<p>Note that closing a stream will close its conversions.</p>

<h3 id="label-java.util.Set+to+Set"><code>java.util.Set</code> to <code>Set</code></h3>

<pre class="code ruby"><code class="ruby">set = java.util.HashSet.new([1,2,3])
set.to_set
=&gt; #&lt;Set: {1, 2, 3}&gt;
</code></pre>

<h3 id="label-java.util.Map+to+Hash"><code>java.util.Map</code> to <code>Hash</code></h3>

<pre class="code ruby"><code class="ruby">hash = java.util.HashMap.new(:a =&gt; 123) # or Hashtable
hash.to_hash.class
=&gt; Hash
</code></pre>

<h3 id="label-java.util.List+to+Array"><code>java.util.List</code> to <code>Array</code></h3>

<pre class="code ruby"><code class="ruby">list = java.util.ArrayList.new([1,2,3])  # or Vector, LinkedList, ...
list.to_a
=&gt; [1, 2, 3]
</code></pre>

<p>Note that <code>list.to_array</code> will return a <em>primitive java
array</em>.</p>

<h3 id="label-Time+to+java.util.Date"><code>Time</code> to <code>java.util.Date</code></h3>

<pre class="code ruby"><code class="ruby">t = Time.now
t.to_java
=&gt; #&lt;Java::JavaUtil::Date:0x747541f8&gt;
</code></pre>

<h2 id="label-Gotchas">Gotchas</h2>

<p>Note that currently you cannot call java methods from within a ruby
class&#39; constructor that inherits from a java class, without first
calling  super or it results in a stack overflow <a
href="http://www.ruby-forum.com/topic/217475">www.ruby-forum.com/topic/217475</a></p>

<h2 id="label-Referencing+a+java.lang.Class+object">Referencing a <code>java.lang.Class</code> object</h2>

<p>If you call a Java class from JRuby and need to pass a Java class as an
argument, if you use this form:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>DoSomethingWithJavaClass</span><span class='lparen'>(</span><span class='const'>MyJavaClass</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='rparen'>)</span>
</code></pre>

<p>you&#39;ll get this error:</p>

<pre class="code ruby"><code class="ruby">TypeError: expected [java.lang.Class]; 
  got: [org.jruby.RubyClass]; error: argument type mismatch
</code></pre>

<p>Instead use the method <code>java_class</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>DoSomethingWithJavaClass</span><span class='lparen'>(</span><span class='const'>MyJavaClass</span><span class='period'>.</span><span class='id identifier rubyid_java_class'>java_class</span><span class='rparen'>)</span>
</code></pre>

<h2 id="label-Integrating+JRuby+and+Java+Classes+and+Interfaces">Integrating JRuby and Java Classes and Interfaces</h2>

<h2 id="label-Classes">Classes</h2>

<h2 id="label-Reopening+Java+Classes">Reopening Java Classes</h2>

<p>In Ruby, classes are always open, which means that you can later add
methods to existing classes. This also works with Java classes.</p>

<p>This comes in handy when adding syntactic sugar like overloaded operators
to Java classes, or other methods to make them behave more Ruby-like.</p>

<p>Note that these additions will only be visible on the JRuby side.</p>

<h2 id="label-Subclassing+a+Java+class">Subclassing a Java class</h2>

<p>You can subclass (i.e. extend) a Java class and then use the JRuby class
whenever Java expects the superclass.</p>

<h2 id="label-Creating+anonymous+classes">Creating anonymous classes</h2>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_foo'>foo</span> <span class='op'>=</span> <span class='const'>Class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>Java</span><span class='op'>::</span><span class='id identifier rubyid_my'>my</span><span class='period'>.</span><span class='id identifier rubyid_package'>package</span><span class='period'>.</span><span class='const'>MyClass</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_method1'>method1</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
    <span class='comment'># override method1
</span>  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_method2'>method2</span><span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span>
    <span class='comment'># override method2
</span>  <span class='kw'>end</span>
  <span class='comment'># etc...
</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_my_args'>my_args</span><span class='rparen'>)</span>
</code></pre>

<h2 id="label-Accessing+package%2C+protected+and+private+fields">Accessing package, protected and private fields</h2>

<p>If you need to access package, protected and private fields on a Java
class, you are able to do so with field_reader, field_writer and
field_accessor attributes.</p>

<p>The methods field_reader, field_writer, field_accessor are analogues to
attr_reader, attr_writer, and attr_accessor and take a symbol name of the
field you want to access as a an argument.</p>

<p>For example, if you have a java class of:</p>

<pre class="code ruby"><code class="ruby">public class Something {

 protected float somevalue = 1.0f;

}
</code></pre>

<p>And you want to access the protected field <code>somevalue</code> from a
subclass that is defined in JRuby, you can do the following:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>SomethingElse</span> <span class='op'>&lt;</span> <span class='const'>Something</span>
  <span class='id identifier rubyid_field_accessor'>field_accessor</span> <span class='symbol'>:somevalue</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_initialise'>initialise</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_somevalue'>somevalue</span><span class='lparen'>(</span><span class='float'>2.0</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

<span class='kw'>end</span>
</code></pre>

<h2 id="label-Gotchas">Gotchas</h2>

<p>If you have a class name ambiguity between Java and Ruby, the class name
will reference the Ruby construct within the Ruby code. For instance, if
you import <code>java.lang.Thread</code> and then write <code>JThread &lt;
Thread</code>, <code>JThread</code> will in fact inherit the Ruby
<code>Thread</code> object, not the Java <code>Thread</code>. The solution
is to use the full Java Class name, such as:  <code>JThread &lt;
java.lang.Thread</code></p>

<h2 id="label-Interfaces">Interfaces</h2>

<p>Java interfaces are mapped to modules in JRuby. This means that you can
also reopen the corresponding module and add further methods on the JRuby
side.</p>

<h2 id="label-Implementing+Java+Interfaces+in+JRuby">Implementing Java Interfaces in JRuby</h2>

<p>JRuby classes can now implement more than one Java interface. Since Java
interfaces are mapped to modules in JRuby, you implement them not by
subclassing, but by mixing them in.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>SomeJRubyObject</span>
    <span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>Runnable</span>
    <span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>Comparable</span>
  <span class='kw'>end</span>
</code></pre>

<h2 id="label-Closure+Conversion">Closure Conversion</h2>

<p>JRuby sports a <em>closure conversion</em> feature (a.k.a.
proc-to-interface conversion), where a Ruby block (closure) is converted to
an appropriate Java interface. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_button'>button</span> <span class='op'>=</span> <span class='id identifier rubyid_javax'>javax</span><span class='period'>.</span><span class='id identifier rubyid_swing'>swing</span><span class='period'>.</span><span class='const'>JButton</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Press me!</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_button'>button</span><span class='period'>.</span><span class='id identifier rubyid_add_action_listener'>add_action_listener</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You did it!</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
</code></pre>

<p>In this example, <code>JButton</code>&#39;s <code>addActionListener</code>
method takes one parameter, a <code>java.awt.event.ActionListener</code>.
The block is converted to a <code>Proc</code> object, which is then
decorated with a java interface proxy that invokes the block for any method
called on the interface.</p>

<p>This works for any interface, but fits best when implementing
functional-style interfaces (those that contain one method to be
implemented).</p>

<p>In (rare) cases where there are multiple matching Java methods with
different interface last parameters, the block arity is taken into
consideration. Here&#39;s an example of the <a
href="http://docs.oracle.com/javase/7/docs/api/java/io/File.html#listFiles%28java.io.FilenameFilter%29">overloaded</a>
<code>java.io.File#listFiles</code> method: <code>ruby
java.io.File.new(&#39;.&#39;).listFiles do |pathname|   # matches
listFiles( FileFilter#accept(File) ) end </code> <code>ruby # listFiles(
FilenameFilter#accept(File, String) )
java.io.File.new(&#39;.&#39;).listFiles do |dir, name|   # calls listFiles(
FilenameFilter#accept(File, String) ) end </code> <strong>Note</strong>:
This <a
href="http://jewelruby.kares.org/an-obvious-java-dispatch">feature</a> is
available since JRuby <strong>1.7.22</strong> and <strong>9.0.1.0</strong>.</p>

<h2 id="label-Java+classes+can%27t+inherit+from+a+JRuby+class">Java classes can&#39;t inherit from a JRuby class</h2>

<p>Hopefully this feature will be added in the planned re-write of the Java
integration layer in a future release of JRuby.</p>

<h2 id="label-Exception+Handling">Exception Handling</h2>

<p>Native Java exceptions can be caught in Ruby code as expected:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>begin</span>
   <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>Integer</span><span class='period'>.</span><span class='id identifier rubyid_parse_int'>parse_int</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>asdf</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
 <span class='kw'>rescue</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>NumberFormatException</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
   <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to parse integer: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
 <span class='kw'>end</span>
</code></pre>

<p><em>Note: Java exceptions do not inherit from ruby Exception, but they will
be caught by <code>rescue</em></code></p>

<p>Furthermore, Ruby code can throw Java exceptions:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>begin</span>
   <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>IllegalArgumentException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bad param</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
 <span class='kw'>rescue</span> <span class='id identifier rubyid_java'>java</span><span class='period'>.</span><span class='id identifier rubyid_lang'>lang</span><span class='period'>.</span><span class='const'>IllegalArgumentException</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
   <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Illegal argument: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
 <span class='kw'>end</span>
</code></pre>

<p>This is useful if you happen to be implementing a Java interface in Ruby
that requires a particular exception to be thrown on error.</p>

<p>Note that this can also be written:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>begin</span>
   <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Java</span><span class='op'>::</span><span class='const'>JavaLang</span><span class='op'>::</span><span class='const'>IllegalArgumentException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bad param</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
 <span class='kw'>rescue</span> <span class='const'>Java</span><span class='op'>::</span><span class='const'>JavaLang</span><span class='op'>::</span><span class='const'>IllegalArgumentException</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
   <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Illegal argument: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
 <span class='kw'>end</span>
</code></pre>

<h2 id="label-Synchronization+in+JRuby">Synchronization in JRuby</h2>

<p>When interacting with Java APIs from JRuby, it is occasionally necessary to
synchronize on an object for thread safety. In JRuby, a
<code>synchronized</code> method is provided on every wrapped Java object
to support this functionality. For example, the following Java code:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_synchronized'>synchronized</span><span class='lparen'>(</span><span class='id identifier rubyid_obj'>obj</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
     <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_wait'>wait</span><span class='lparen'>(</span><span class='int'>1000</span><span class='rparen'>)</span><span class='semicolon'>;</span> 
 <span class='rbrace'>}</span></code></pre>

<p>is implement like this in Ruby:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_synchronized'>synchronized</span> <span class='kw'>do</span>
   <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_wait'>wait</span> <span class='int'>1000</span>
 <span class='kw'>end</span>
</code></pre>

<p>The expression evaluates to the result of the block, e.g.,</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_synchronized'>synchronized</span> <span class='lbrace'>{</span> <span class='int'>99</span> <span class='rbrace'>}</span>  <span class='comment'># =&gt; 99
</span></code></pre>

<h2 id="label-Converting+a+java+Object+to+a+non+primitive+class">Converting a java Object to a non primitive class</h2>

<p>There can be instances (in closures for example) where you need to convert
a java Object to a specific class/interface you can do this using a custom
<code>to_java</code> eg <code>ruby { |obj| d =
obj.to_java(Java::Hype::HDrawable); d.stroke(100) ..etc } </code> You may
find that this is preferable to creating an anonymous class when
implementing a simple (one method) interface, especially since jdk8 has
lambda support, and even java people have seen the light.</p>
</div></div>

    <div id="footer">
  Generated on Sat Apr 23 15:20:28 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.3).
</div>

  </body>
</html>